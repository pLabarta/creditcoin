<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Client - Creditcoin Dev Guide</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = null;
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../getting-started.html"><strong aria-hidden="true">1.</strong> Getting started</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../getting-started/building.html"><strong aria-hidden="true">1.1.</strong> Building from source</a></li><li class="chapter-item expanded "><a href="../getting-started/running-a-node.html"><strong aria-hidden="true">1.2.</strong> Running a development node</a></li><li class="chapter-item expanded "><a href="../getting-started/observing-your-chain.html"><strong aria-hidden="true">1.3.</strong> Observing your development chain</a></li><li class="chapter-item expanded "><a href="../getting-started/substrate-resources.html"><strong aria-hidden="true">1.4.</strong> Learning about substrate</a></li></ol></li><li class="chapter-item expanded "><a href="../architecture.html"><strong aria-hidden="true">2.</strong> Architecture and Repo Layout</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../architecture/client.html" class="active"><strong aria-hidden="true">2.1.</strong> Client</a></li><li class="chapter-item expanded "><a href="../architecture/runtime/runtime.html"><strong aria-hidden="true">2.2.</strong> Runtime</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../architecture/runtime/pallet-creditcoin.html"><strong aria-hidden="true">2.2.1.</strong> Creditcoin pallet</a></li><li class="chapter-item expanded "><a href="../architecture/runtime/pallet-difficulty.html"><strong aria-hidden="true">2.2.2.</strong> Difficulty pallet</a></li></ol></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Creditcoin Dev Guide</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="client--outer-node"><a class="header" href="#client--outer-node">Client / Outer Node</a></h1>
<p>This is the part that handles all interactions with the host machine and outside world.
By extension, the client is the primary point of interaction for node operators - whether that be
through the CLI or by performing RPC calls.
The code for the client lives in the <a href="https://github.com/gluwa/creditcoin/tree/dev/node"><code>node</code> directory</a>.</p>
<h2 id="cli"><a class="header" href="#cli">CLI</a></h2>
<p>The command line interface you interact with as a user (the <code>creditcoin-node</code> binary) uses
<a href="https://docs.rs/clap">clap</a>, similar to many Rust projects.
The actual interface is defined in <a href="https://github.com/gluwa/creditcoin/tree/dev/node/src/cli.rs"><code>node/src/cli.rs</code></a>. It consists of the
CLI options and subcommands.</p>
<p>The actual parsing and execution of the CLI command occurs in <a href="https://github.com/gluwa/creditcoin/tree/dev/node/src/command.rs"><code>command.rs</code></a>.
This is the entrypoint to a creditcoin node (<code>main</code> just calls into <code>command::run</code>)
For most subcommands this means calling the appropriate implementations provided by substrate.</p>
<p>When running a node (as opposed to a subcommand), we call into the <code>service</code> module to actual construct
the client.</p>
<h2 id="service"><a class="header" href="#service">Service</a></h2>
<p>This is where we put together all of the pieces of the client - configuring storage, kicking off networking,
setting up the RPC server,
connecting to telemetry, setting up the block import pipeline (and consensus, which is part of the import pipeline), and more.
This is also the entrypoint to mining (we just spawn a bunch of threads which are tasked with mining and submitting results).</p>
<p>This code lives in <a href="https://github.com/gluwa/creditcoin/tree/dev/node/src/service.rs"><code>node/src/service.rs</code></a>.</p>
<h2 id="rpc"><a class="header" href="#rpc">RPC</a></h2>
<p>This is where we define custom RPC methods and extend the standard RPC server with our custom method handlers.
For example, we expose a custom RPC method for retrieving
your node's current hashrate so node operators can monitor their mining performance.</p>
<p>The code for extending the RPC server with custom handlers lives in <a href="https://github.com/gluwa/creditcoin/tree/dev/node/src/rpc.rs"><code>node/src/rpc.rs</code></a>. Once
you've defined your custom RPC methods and their handlers, you would need to edit this code to register your new handlers.</p>
<p>The code for <em>defining</em> new RPC methods is currently located in <a href="https://github.com/gluwa/creditcoin/tree/dev/node/rpc"><code>node/rpc</code></a>.</p>
<h2 id="consensus--pow"><a class="header" href="#consensus--pow">Consensus / PoW</a></h2>
<p>The client also contains consensus-related code. Creditcoin uses Proof of Work, which requires block authors
to generate solutions to a problem (mining) and if a &quot;good enough&quot; solution is produced then a block can be authored. The majority of the actual
consensus is implemented in substrate, so the only parts we have to worry about are providing the difficulty, verifying
a given solution, and generating solutions (mining).</p>
<h3 id="difficulty"><a class="header" href="#difficulty">Difficulty</a></h3>
<p>The difficulty is actually determined in runtime logic, so on the client-side we use a runtime API to call into the runtime
logic and get the difficulty for the current block. More specifically, the difficulty adjustment and management occurs in the
difficulty pallet (detailed in the <code>runtime</code> section).</p>
<h3 id="verifying-a-solution"><a class="header" href="#verifying-a-solution">Verifying a Solution</a></h3>
<p>First to clarify, in our case the &quot;problem&quot; miners are solving is the following:</p>
<pre><code class="language-pseudocode">encode(arg) = SCALE encode arg to bytes
sha3(bytes) = calculate sha3 hash of the given bytes
concat(a, b,...) = concatenate a, b, ...

// H256 is a 256-bit hash type, U256 is a 256-bit unsigned integer type

def do_work(difficulty: U256, pre_hash: H256, nonce: H256) -&gt; H256:
    return sha3(concat(encode(difficulty), encode(pre_hash), encode(nonce)))

def is_solution(work: H256, nonce: H256, difficulty: U256, pre_hash: H256) -&gt; bool:
    calculated = do_work(difficulty)

    // U256.MAX is the maximum value for an unsigned 256-bit integer, i.e.  2^256 - 1

    return work == calculated and U256(work) * difficulty &lt;= U256.MAX

// choose a nonce such that is_solution(do_work(difficulty, pre_hash, nonce), nonce, difficulty, pre_hash) == True
</code></pre>
<p>Given a proposed solution, we consider it valid if</p>
<ol>
<li>The hash is correct (matches the value obtained by recalculating the hash from input data)</li>
<li>The product of the hash and difficulty do not overflow a 256-bit unsigned integer. In other words <code>hash * difficulty &lt;= 2^256 - 1</code></li>
</ol>
<p>This code lives in the <a href="https://github.com/gluwa/creditcoin/tree/dev/sha3pow"><code>sha3pow</code> crate</a>.</p>
<h3 id="generating-solutions-mining"><a class="header" href="#generating-solutions-mining">Generating Solutions (Mining)</a></h3>
<p>Mining comes down to essentially picking random nonce values until you find one with the correct properties.
Once we find an appropriate nonce, we submit the solution to a <code>MiningHandle</code> which then proceeds with verification and moving forward
with publishing the block. This occurs in <a href="https://github.com/gluwa/creditcoin/tree/dev/node/src/service.rs"><code>service.rs</code></a> in the <code>creditcoin-node</code> crate.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../architecture.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="../architecture/runtime/runtime.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../architecture.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="../architecture/runtime/runtime.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../mermaid.min.js"></script>
        <script src="../mermaid-init.js"></script>


    </div>
    </body>
</html>
